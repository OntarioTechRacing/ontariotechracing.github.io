<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width initial-scale=1.0">

    <!-- Add favicon. -->
    <link rel="icon" href="/assets/img/otr_logo_grey-512x512.png"
          type="image/png">

    <!-- Tab title. -->
    <title>{{ page.title | default: site.title | default: "title" }}</title>

    <!-- Link to GitHub's Primer CSS: https://primer.style/. -->
    <link rel="stylesheet" href="https://unpkg.com/@primer/css/index.css">

    <!-- Custom style sheet. -->
    <link rel="stylesheet" href="/assets/css/style.css">

    <!-- MathJax JavaScript with equation delimiter configuration. -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [["$", "$"]],  // Set inline delimiters.
                displayMath: [["$$", "$$"]]  // Set display delimiters.
            },
            svg: {
                fontCache: "global"
            }
        };
    </script>
    <script id="MathJax-script" async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- JavaScript redirect handling for markdown header redirects. -->
    <!--
        Event Listener for DOMContentLoaded: Ensures the script runs only after the entire document is loaded.
        Select Specific Links: It uses querySelectorAll with a[href^="#"] to select only those <a> tags whose href attributes start exactly with a #.
        Modify Each Link: For each selected link, the script removes digits that directly follow the # and are immediately followed by a hyphen.
        Update Each Link's href: It then updates the href attribute with the modified anchor link.
    -->
    <script defer>
        document.addEventListener("DOMContentLoaded", function () {
            var links = document.querySelectorAll('a[href^="#"]');
            links.forEach(function (link) {
                var originalHref = link.getAttribute('href');
                var modifiedHref = originalHref.replace(/^#(\d+)-/, '#');
                link.setAttribute('href', modifiedHref);
            });
        });
    </script>

    <!-- JavaScript running table of contents. -->
    <script defer>
        document.addEventListener("DOMContentLoaded", function () {
            const baseUrl = "https://ontariotechracing.github.io";

            // Extract path segments from the current URL, excluding the base part and file name.
            const pathSegments = window.location.pathname.replace("/index.html", "").split("/").filter(segment => segment);

            let currentPath = baseUrl;
            const fetchPromises = [];

            // Prepare fetch promises for each segment path.
            pathSegments.forEach((segment, index) => {
                currentPath += "/" + segment;
                fetchPromises.push(fetch(currentPath + "/index.html").then(response => response.text()));
            });

            Promise.all(fetchPromises).then(pages => {
                let contentHtml = document.createElement("div"); // Container for nested lists.
                contentHtml.style.padding = "4ch"; // Set padding of 4ch.
                contentHtml.className = "markdown-body";

                // Wrap in details dropdown.
                let details = document.createElement("details");
                let summary = document.createElement("summary");
                summary.textContent = "Table of Contents";
                details.appendChild(summary);

                // Process each page's HTML content.
                pages.forEach((pageHtml, index) => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(pageHtml, "text/html");
                    const h2 = doc.querySelector("h2#manifest");
                    const ul = h2 && h2.nextElementSibling.tagName === "UL" ? h2.nextElementSibling : null;

                    if (ul) {
                        // Create nested ul based on index.
                        let nestedContainer = details;
                        for (let i = 0; i < index; i++) {
                            if (!nestedContainer.lastElementChild || nestedContainer.lastElementChild.tagName !== "UL") {
                                let newUl = document.createElement("ul");
                                nestedContainer.appendChild(newUl);
                                nestedContainer = newUl;
                            } else {
                                nestedContainer = nestedContainer.lastElementChild;
                            }
                        }

                        // Append the ul to the correct depth.
                        nestedContainer.appendChild(ul.cloneNode(true)); // Clone to append the entire ul structure.
                    }
                });

                // Append the details element with all contents to the div, then to the header.
                contentHtml.appendChild(details);

                const header = document.querySelector("header");
                if (header) {
                    header.appendChild(contentHtml);
                }
            }).catch(error => {
                console.error("Failed to fetch or parse page:", error);
            });
        });
    </script>

</head>

<body>

<header>
    <div class="markdown-body" style="padding: 4ch; text-align:center;">
        <img src="/assets/img/otr_logo_grey.png"
             style="height: 10ch; display: block; margin: auto;"
             alt="otr_logo_grey">
        <a href="https://ontariotechracing.github.io/">
            OntarioTechRacing.github.io
        </a>
    </div>
</header>

<main>
    <div class="markdown-body" style="padding: 4ch;">
        {{ content }}
    </div>
</main>

<footer>
    <div class="markdown-body" style="padding: 4ch; text-align:center;">
        <p>
            {{ site.time | date: '%Y-%m-%d' }}
        </p>
    </div>
</footer>

</body>

</html>
